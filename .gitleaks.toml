title = "NestJS Project Secrets Detection"

# ========== ALLOWLIST (False positives to ignore) ==========
[allowlist]
description = "Files and patterns to ignore"

# Files to completely ignore
files = [
  '''^package\.json$''',
  '''^package-lock\.json$''',
  '''^yarn\.lock$''',
  '''^pnpm-lock\.yaml$''',
  '''\.min\.js$''',
  '''\.spec\.ts$''',
  '''\.test\.ts$'''
]

# Patterns to ignore (even if they match rules)
regexes = [
  '''example\.com''',
  '''example@email\.com''',
  '''EXAMPLE''',
  '''CHANGE_ME''',
  '''YOUR_.*_HERE''',
  '''TODO''',
  '''FIXME''',
  '''HACK''',
  '''NOTE:''',
  '''DEBUG'''
]

# ========== RULES (What to detect) ==========

# AWS Credentials
[[rules]]
id = "aws-access-key"
description = "AWS Access Key ID"
regex = '''(A3T[A-Z0-9]|AKIA|AGPA|AIDA|AROA|AIPA|ANPA|ANVA|ASIA)[A-Z0-9]{16}'''
tags = ["aws", "key", "cloud"]

[[rules]]
id = "aws-secret-key"
description = "AWS Secret Access Key"
regex = '''['"][A-Za-z0-9/+]{40}['"]'''
tags = ["aws", "secret", "cloud"]

# GitHub Tokens
[[rules]]
id = "github-pat"
description = "GitHub Personal Access Token"
regex = '''(ghp|gho|ghu|ghs|ghr)_[A-Za-z0-9_]{36}'''
tags = ["github", "token"]

[[rules]]
id = "github-fine-grained"
description = "GitHub Fine-grained Token"
regex = '''github_pat_[0-9a-zA-Z]{22}_[0-9a-zA-Z]{59,}'''
tags = ["github", "token"]

# Database Credentials
[[rules]]
id = "postgres-url"
description = "PostgreSQL URL with password"
regex = '''postgres(ql)?://[^:]+:[^@]+@'''
tags = ["database", "postgres", "credentials"]

[[rules]]
id = "mongodb-url"
description = "MongoDB URL with password"
regex = '''mongodb(\+srv)?://[^:]+:[^@]+@'''
tags = ["database", "mongodb", "credentials"]

[[rules]]
id = "redis-url"
description = "Redis URL with password"
regex = '''redis://[^:]+:[^@]+@'''
tags = ["database", "redis", "credentials"]

# Node.js / NestJS Specific
[[rules]]
id = "jwt-secret"
description = "JWT Secret or Key"
regex = '''(['"]?(secret|privateKey|publicKey|jwtSecret|jwtKey|signature)['"]?\s*[:=]\s*['"])[^'"]{16,}['"]'''
tags = ["jwt", "auth", "nodejs", "nestjs"]

[[rules]]
id = "env-secret"
description = ".env file secret"
regex = '''^[A-Z][A-Z0-9_]*_?(SECRET|KEY|TOKEN|PASSWORD|PASSWD|PWD)_?[A-Z0-9_]*\s*=\s*['"]?[^'"]{8,}['"]?'''
tags = ["env", "config", "secret"]

[[rules]]
id = "typeorm-secret"
description = "TypeORM password in config"
regex = '''password\s*:\s*['"][^'"]{4,}['"]'''
tags = ["typeorm", "database", "nestjs"]

# API Keys & General Secrets
[[rules]]
id = "generic-api-key"
description = "Generic API Key"
regex = '''(['"]?(api[_-]?key|secret[_-]?key|access[_-]?key)['"]?\s*[:=]\s*['"])[A-Za-z0-9]{16,64}['"]'''
tags = ["api", "key", "secret"]

[[rules]]
id = "bearer-token"
description = "Bearer Token"
regex = '''Bearer\s+[A-Za-z0-9\-._~+/]{64,}'''
tags = ["auth", "token", "bearer"]

[[rules]]
id = "encryption-key"
description = "Encryption Key"
regex = '''(['"]?(key|secret)['"]?\s*[:=]\s*['"])[A-Fa-f0-9]{32,}['"]'''
tags = ["crypto", "encryption", "key"]

# NestJS Configuration Specific
[[rules]]
id = "nestjs-config-secret"
description = "NestJS configuration secret"
regex = '''(['"]?(secret|private|key)['"]?\s*:\s*['"])[^'"]{10,}['"](?=\s*,?\s*\})'''
tags = ["nestjs", "config", "secret"]

# ========== GENERAL SETTINGS ==========
[general]
enable-git-history = true
max-target-megabytes = 50
verbose = true
redact = true
